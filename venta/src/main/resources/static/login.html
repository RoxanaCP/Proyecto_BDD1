<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Iniciar sesión</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fuente personalizada -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

  <style>
    :root{
      /* Tema claro con acentos violeta/magenta */
      --bg:#f6f7fb;
      --panel:#ffffff;
      --text:#0f172a;
      --muted:#6b7280;
      --border:#e5e7eb;
      --accent:#a855f7;
      --accent-2:#ec4899;
      --ring: rgba(168,85,247,.28);
      --btn-text:#ffffff;
      --danger:#b91c1c;
      --ok:#16a34a;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100dvh; display:grid; place-items:center;
      background: radial-gradient(1000px 600px at 18% -12%, #eef0fb 0%, var(--bg) 55%);
      color:var(--text);
      font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
    }
    .card{
      width:min(420px, 92vw);
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:18px; padding:26px;
      box-shadow:0 20px 60px rgba(16,24,40,.08), 0 2px 6px rgba(16,24,40,.06);
    }
    h1{margin:0 0 4px; font-size:clamp(22px,3.2vw,28px); font-weight:600}
    p.sub{margin:0 0 18px; color:var(--muted); font-size:14px}

    label{display:block; font-size:13px; color:#334155; margin:14px 0 6px}
    .input{
      width:100%; padding:12px 14px; border-radius:12px;
      border:1px solid var(--border); background:#fff; color:var(--text);
      outline:none; font-size:15px; transition:border .2s, box-shadow .2s, background .2s;
    }
    .input:hover{background:#fafafa}
    .input:focus{border-color:var(--accent); box-shadow:0 0 0 4px var(--ring)}

    .row{display:flex; align-items:center; justify-content:space-between; margin-top:10px}
    .showpass{display:flex; align-items:center; gap:8px; font-size:13px; color:#475569}
    .showpass input{accent-color:var(--accent)}

    .btn{
      width:100%; margin-top:16px;
      appearance:none; border:none; cursor:pointer;
      padding:12px 16px; border-radius:12px; font-weight:600; letter-spacing:.2px;
      background:linear-gradient(90deg,var(--accent) 0%, var(--accent-2) 100%);
      color:var(--btn-text); box-shadow:0 8px 20px rgba(168,85,247,.25);
      transition:filter .2s, transform .03s;
    }
    .btn:active{transform:translateY(1px)}
    .btn[disabled]{filter:grayscale(.3) brightness(.95); cursor:not-allowed}

    .msg{
      margin-top:12px; font-size:13px; border-radius:10px; padding:10px 12px;
      border:1px solid var(--border); display:none;
    }
    .msg.error{display:block; color:#991b1b; background:#fff0f0; border-color:#fecaca}
    .msg.ok{display:block; color:#065f46; background:#ecfdf5; border-color:#bbf7d0}

    .spinner{width:16px; height:16px; border:2px solid #e2e8f0; border-top-color:#fff; border-radius:50%; display:inline-block; vertical-align:-3px; animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .brand{
      display:flex; align-items:center; gap:10px; margin-bottom:6px;
      color:#6b21a8; font-weight:600; letter-spacing:.2px;
    }
    .brand .logo{
      width:36px; height:36px; border-radius:10px;
      display:grid; place-items:center; color:#fff;
      background:linear-gradient(135deg, var(--accent), var(--accent-2));
      font-weight:700;
      box-shadow:0 8px 18px rgba(168,85,247,.35);
    }
  </style>
</head>
<body>
  <main class="card" role="main">
    <div class="brand">
      <div class="logo">VR</div>
      <div>Venta Ropa • Acceso</div>
    </div>
    <h1>Iniciar sesión</h1>
    <p class="sub">Ingresa con tu usuario y contraseña.</p>

    <form id="formLogin" novalidate>
      <label for="username">Usuario</label>
      <input class="input" id="username" name="username" type="text" placeholder="Tu usuario" autocomplete="username" required />

      <label for="password">Contraseña</label>
      <input class="input" id="password" name="password" type="password" placeholder="••••••••" autocomplete="current-password" required />

      <div class="row">
        <label class="showpass"><input type="checkbox" id="togglePass" /> Mostrar contraseña</label>
      </div>

      <button type="submit" id="btnLogin" class="btn">Entrar</button>

      <div id="msg" class="msg" role="alert"></div>
    </form>
  </main>

  <script>
    // ==== Ajusta si usas context-path (p.ej. "/venta")
    const BASE_URL  = "http://localhost:8080";     // backend
    const ENDPOINT_LOGIN = BASE_URL + "/auth/login";
    const MENU_PAGE = "menu.html";                 // ruta a tu menu (misma carpeta). Cámbialo si está en otra ruta.

    const f = document.getElementById('formLogin');
    const btn = document.getElementById('btnLogin');
    const msg = document.getElementById('msg');
    const user = document.getElementById('username');
    const pass = document.getElementById('password');
    const toggle = document.getElementById('togglePass');

    toggle.addEventListener('change', () => {
      pass.type = toggle.checked ? 'text' : 'password';
    });

    function showError(text){
      msg.className = 'msg error';
      msg.textContent = text;
    }
    function showOk(text){
      msg.className = 'msg ok';
      msg.textContent = text;
    }
    function clearMsg(){ msg.className='msg'; msg.textContent=''; }

    f.addEventListener('submit', async (e) => {
      e.preventDefault();
      clearMsg();

      if(!user.value || !pass.value){
        showError('Por favor completa usuario y contraseña.');
        return;
      }

      // loading
      btn.disabled = true;
      const original = btn.innerHTML;
      btn.innerHTML = '<span class="spinner"></span> Verificando…';

      try{
        const r = await fetch(ENDPOINT_LOGIN, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username: user.value, password: pass.value })
        });

        if(!r.ok){
          const text = await r.text();
          showError(text || 'Usuario o contraseña inválidos.');
        }else{
          const data = await r.json();
          // Guarda datos mínimos para usarlos en menu.html
          sessionStorage.setItem('usuario', JSON.stringify({
            idUsuario: data.idUsuario,
            nombreUsuario: data.nombreUsuario,
            activo: data.activo
          }));
          // Redirige a menu.html
          window.location.href = MENU_PAGE;
        }
      }catch(err){
        console.error(err);
        showError('No se pudo conectar con el servidor.');
      }finally{
        btn.disabled = false;
        btn.innerHTML = original;
      }
    });
  </script>
</body>
</html>
