<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Clientes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

  <style>
    :root {
      --bg:#f6f7fb; --panel:#ffffff; --muted:#6b7280; --text:#0f172a;
      --border:#e5e7eb; --accent:#7c3aed; --accent-2:#a855f7; --ring:rgba(124,58,237,.25);
    }

    body {
      background: radial-gradient(1000px 600px at 18% -12%, #eef0fb 0%, var(--bg) 55%);
      font-family:"Poppins", system-ui, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      padding: 20px;
    }

    h2 { font-weight: 600; color: var(--accent); }

    .card {
      background: var(--panel); border:1px solid var(--border);
      border-radius:18px; padding:20px;
      box-shadow:0 16px 46px rgba(16,24,40,.08), 0 2px 6px rgba(16,24,40,.06);
      margin-bottom:20px;
    }

    .btn-primary, .btn-success, .btn-menu {
      border-radius:12px; font-weight:600; transition:0.2s;
    }
    .btn-primary { background: linear-gradient(90deg,var(--accent) 0%, var(--accent-2) 100%); color:#fff; border:none; }
    .btn-primary:hover { opacity:0.9; }
    .btn-success { background: var(--accent-2); color:#fff; border:none; }
    .btn-success:hover { opacity:0.9; }
    .btn-menu { background: var(--accent); color:#fff; border:none; }
    .btn-menu:hover { opacity:0.9; }

    table {
      width:100%; border-collapse:collapse; margin-top:15px;
    }
    th, td { padding:10px; text-align:left; border-bottom:1px solid var(--border); font-size:14px; }
    thead th { font-weight:700; background:#fafafa; color:#334155; }
    tbody tr { background:#fff; border-radius:10px; box-shadow:0 1px 3px rgba(16,24,40,.05); transition:0.2s; }
    tbody tr:hover { transform: scale(1.01); box-shadow:0 4px 12px rgba(16,24,40,.1); }

    input, select { border-radius:12px; border:1px solid var(--border); padding:10px; width:100%; }
    input:focus, select:focus { border-color: var(--accent); box-shadow:0 0 0 4px var(--ring); outline:none; }

    .text-muted { color: var(--muted) !important; }
  </style>
</head>
<body>

<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Clientes registrados</h2>
    <button class="btn-menu" onclick="location.href='menu.html'">‚¨Ö Men√∫</button>
  </div>

  <div class="card">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <span class="text-muted" id="infoClientes"></span>
      <div>
        <button class="btn btn-primary me-2" id="btnCargar">üîÑ Actualizar</button>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalAgregar">‚ûï Nuevo Cliente</button>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>ID Cliente</th>
            <th>Nombre</th>
            <th>G√©nero</th>
            <th>Fecha Nac.</th>
            <th>Pa√≠s (ID)</th>
            <th>NIT</th>
            <th>Email</th>
            <th>Tel√©fono</th>
            <th>Fecha Creaci√≥n</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="tablaClientes"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal Agregar -->
<div class="modal fade" id="modalAgregar" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content p-3">
      <form id="formAgregar">
        <div class="mb-3">
          <label class="form-label">Nombre</label>
          <input type="text" class="form-control" id="nombre" required>
        </div>
        <div class="mb-3">
          <label class="form-label">G√©nero</label>
          <select class="form-control" id="genero" required>
            <option value="">Seleccione...</option>
            <option value="Masculino">Masculino</option>
            <option value="Femenino">Femenino</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Fecha de Nacimiento</label>
          <input type="date" class="form-control" id="fechaNacimiento" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Pa√≠s (ID)</label>
          <input type="number" class="form-control" id="idPais" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Tel√©fono</label>
          <input type="number" class="form-control" id="telefono" required>
        </div>
        <div class="mb-3">
          <label class="form-label">NIT</label>
          <input type="text" class="form-control" id="nit">
        </div>
        <div class="mb-3">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" id="email">
        </div>
        <div class="d-flex justify-content-end gap-2">
          <button type="submit" class="btn btn-success">Guardar</button>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const API = "http://localhost:8080/clientes";
  const tbody = document.getElementById("tablaClientes");
  const infoClientes = document.getElementById("infoClientes");

  async function cargarClientes() {
    tbody.innerHTML = `<tr><td colspan="10" class="text-center text-muted">Cargando...</td></tr>`;
    try {
      const res = await fetch(API);
      const data = await res.json();
      tbody.innerHTML = "";
      let contador = 0;

      for (const c of data) {
        const vista = await fetch(`${API}/${c.idCliente}/vista`).then(r => r.ok ? r.json() : null);
        if (!vista) continue;
        contador++;
        tbody.innerHTML += `
          <tr>
            <td>${vista.idCliente}</td>
            <td>${vista.nombrePersona ?? vista.nombre ?? "-"}</td>
            <td>${vista.genero ?? "-"}</td>
            <td>${vista.fechaNacimiento ? vista.fechaNacimiento.slice(0,10) : "-"}</td>
            <td>${vista.idPais ?? "-"}</td>
            <td>${vista.nit ?? "-"}</td>
            <td>${vista.email ?? "-"}</td>
            <td>${vista.telefono ?? "-"}</td>
            <td>${vista.fechaCreacion ? vista.fechaCreacion.slice(0,10) : "-"}</td>
            <td>
              <button class="btn btn-primary btn-sm" onclick="eliminarCliente(${vista.idCliente})">üóëÔ∏è</button>
            </td>
          </tr>
        `;
      }

      infoClientes.textContent = `Mostrando ${contador} cliente${contador !== 1 ? "s" : ""}.`;
    } catch {
      infoClientes.textContent = "Error al cargar clientes.";
    }
  }

  document.getElementById("formAgregar").addEventListener("submit", async e => {
    e.preventDefault();
    const nuevo = {
      idPais: parseInt(document.getElementById("idPais").value),
      nombre: document.getElementById("nombre").value,
      genero: document.getElementById("genero").value,
      fechaNacimiento: document.getElementById("fechaNacimiento").value,
      telefono: document.getElementById("telefono").value.toString(),
      nit: document.getElementById("nit").value,
      email: document.getElementById("email").value
    };
    const res = await fetch(`${API}/agregar`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(nuevo)
    });
    if(res.ok) {
      alert("Cliente agregado con √©xito");
      document.getElementById("formAgregar").reset();
      const modal = bootstrap.Modal.getInstance(document.getElementById("modalAgregar"));
      modal.hide();
      cargarClientes();
    } else {
      alert("Error al agregar cliente");
    }
  });

  async function eliminarCliente(id) {
    if(!confirm("¬øSeguro que quieres eliminar este cliente?")) return;
    const res = await fetch(`${API}/eliminar/${id}`, { method:"DELETE" });
    if(res.ok) cargarClientes();
  }

  document.getElementById("btnCargar").addEventListener("click", cargarClientes);
  window.addEventListener("DOMContentLoaded", cargarClientes);
</script>
</body>
</html>
